<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Login System</title>
<style>
body {
  font-family: sans-serif;
  background:#f2f2f2;
}
.box {
  background:white;
  padding:20px;
  margin:40px auto;
  width:320px;
  border-radius:8px;
}
input, button {
  width:100%;
  padding:8px;
  margin-top:6px;
}
button {
  cursor:pointer;
}
.admin {
  background:#ffeeba;
  padding:10px;
  margin-top:20px;
}
</style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>ログイン</h2>
  <input id="loginUser" placeholder="ID">
  <input id="loginPass" type="password" placeholder="パスワード">
  <button onclick="login()">ログイン</button>
  <p id="status"></p>
</div>

<div class="box" id="appBox" style="display:none;">
  <p id="info"></p>
  <button onclick="logout()">ログアウト</button>

  <div class="admin" id="adminBox" style="display:none;">
    <h3>管理者画面</h3>

    <input id="newUser" placeholder="新ID">
    <input id="newPass" placeholder="新パスワード">
    <button onclick="addUser()">追加</button>

    <ul id="userList"></ul>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabase.createClient(
  "https://speopkpxkpmspuxjgyde.supabase.co",
  "sb_publishable_ywXntr_4W851vxWRjZ3dPA_uCvLurUu"
);

let currentUser = null;

async function login() {
  const u = document.getElementById("loginUser").value;
  const p = document.getElementById("loginPass").value;

  const { data } = await supabase
    .from("users")
    .select("*")
    .eq("username", u)
    .eq("password", p)
    .single();

  if (!data) {
    status.textContent = "ログイン失敗";
    return;
  }

  currentUser = data;
  loginBox.style.display = "none";
  appBox.style.display = "block";
  info.textContent = "ログイン中：" + data.username;

  if (data.is_admin) {
    adminBox.style.display = "block";
    loadUsers();
  }
}

function logout() {
  currentUser = null;
  appBox.style.display = "none";
  loginBox.style.display = "block";
}

async function loadUsers() {
  const { data } = await supabase.from("users").select("*");
  userList.innerHTML = "";
  data.forEach(u => {
    const li = document.createElement("li");
    li.textContent = `${u.username} / ${u.password}`;
    const del = document.createElement("button");
    del.textContent = "削除";
    del.onclick = () => deleteUser(u.id);
    li.appendChild(del);
    userList.appendChild(li);
  });
}

async function addUser() {
  const u = newUser.value;
  const p = newPass.value;
  await supabase.from("users").insert([{ username:u, password:p, is_admin:false }]);
  newUser.value = "";
  newPass.value = "";
  loadUsers();
}

async function deleteUser(id) {
  await supabase.from("users").delete().eq("id", id);
  loadUsers();
}
</script>
</body>
</html>
